{
  "workflow_name": "网络攻击检测智能体",
  "workflow_version": "1.0.0",
  "description": "基于报文分析、上下文特征提取、规则引擎和LLM深度分析的网络攻击检测系统",
  "workflow_structure": {
    "nodes": [
      {
        "id": "packet_input",
        "name": "报文输入模块",
        "type": "python_module",
        "description": "处理旁路镜像转发的HTTP请求报文",
        "module_config": {
          "function_name": "execute_packet_input",
          "file_path": "modules/packet_input.py",
          "input_schema": {
            "type": "string",
            "description": "原始报文数据(JSON格式)"
          },
          "output_schema": {
            "type": "object",
            "properties": {
              "packet_id": {"type": "string"},
              "timestamp": {"type": "string"},
              "source_ip": {"type": "string"},
              "method": {"type": "string"},
              "url": {"type": "string"},
              "headers": {"type": "object"},
              "body": {"type": "string"},
              "validation": {"type": "object"},
              "suspicious_patterns": {"type": "object"}
            }
          }
        },
        "position": {"x": 100, "y": 100}
      },
      {
        "id": "context_extraction",
        "name": "上下文特征提取模块",
        "type": "python_module",
        "description": "提取并统计网络攻击检测相关的上下文特征",
        "module_config": {
          "function_name": "execute_context_feature_extraction",
          "file_path": "modules/context_feature_extraction.py",
          "input_schema": {
            "type": "string",
            "description": "报文输入模块的输出JSON数据"
          },
          "output_schema": {
            "type": "object",
            "properties": {
              "ip_features": {"type": "object"},
              "url_features": {"type": "object"},
              "time_features": {"type": "object"},
              "anomaly_features": {"type": "object"},
              "risk_indicators": {"type": "object"}
            }
          }
        },
        "position": {"x": 300, "y": 100}
      },
      {
        "id": "rule_engine",
        "name": "规则引擎与扫描函数模块",
        "type": "python_module",
        "description": "基于专家规则进行攻击检测和风险评估",
        "module_config": {
          "function_name": "execute_rule_engine_scan",
          "file_path": "modules/rule_engine_scanner.py",
          "input_schema": {
            "type": "object",
            "properties": {
              "packet_data": {"type": "string"},
              "context_features": {"type": "string"}
            }
          },
          "output_schema": {
            "type": "object",
            "properties": {
              "is_attack": {"type": "boolean"},
              "attack_types": {"type": "array"},
              "risk_level": {"type": "string"},
              "confidence_score": {"type": "number"},
              "requires_llm_analysis": {"type": "boolean"}
            }
          }
        },
        "position": {"x": 500, "y": 100}
      },
      {
        "id": "risk_decision",
        "name": "风险决策节点",
        "type": "switch_case",
        "description": "根据规则引擎结果决定后续流程",
        "switch_config": {
          "condition_field": "risk_level",
          "cases": [
            {
              "condition": "严重",
              "next_node": "llm_analysis"
            },
            {
              "condition": "高风险",
              "next_node": "llm_analysis"
            },
            {
              "condition": "中风险",
              "next_node": "suspicious_check"
            },
            {
              "condition": "低风险",
              "next_node": "safe_pass"
            }
          ],
          "default_case": "safe_pass"
        },
        "position": {"x": 700, "y": 100}
      },
      {
        "id": "suspicious_check",
        "name": "可疑特征检查",
        "type": "switch_case",
        "description": "检查是否有可疑特征需要LLM分析",
        "switch_config": {
          "condition_field": "requires_llm_analysis",
          "cases": [
            {
              "condition": true,
              "next_node": "llm_analysis"
            },
            {
              "condition": false,
              "next_node": "safe_pass"
            }
          ],
          "default_case": "safe_pass"
        },
        "position": {"x": 700, "y": 250}
      },
      {
        "id": "llm_prompt_generator",
        "name": "LLM提示词生成器",
        "type": "python_module",
        "description": "为LLM分析生成专业的提示词",
        "module_config": {
          "function_name": "generate_llm_prompt",
          "file_path": "prompts/llm_analysis_prompts.py",
          "input_schema": {
            "type": "object",
            "properties": {
              "packet_data": {"type": "string"},
              "context_features": {"type": "string"},
              "rule_engine_result": {"type": "string"},
              "analysis_type": {"type": "string", "default": "security_analysis"}
            }
          }
        },
        "position": {"x": 900, "y": 100}
      },
      {
        "id": "llm_analysis",
        "name": "LLM深度研判模块",
        "type": "llm_module",
        "description": "使用大语言模型进行深度安全分析",
        "llm_config": {
          "model": "gpt-4",
          "temperature": 0.1,
          "max_tokens": 2000,
          "system_prompt": "你是一位资深的网络安全专家，专门负责深度分析网络攻击和威胁。请基于提供的数据进行专业、准确的安全分析。",
          "input_from_node": "llm_prompt_generator",
          "output_format": "structured_json"
        },
        "position": {"x": 1100, "y": 100}
      },
      {
        "id": "response_generator",
        "name": "响应生成器",
        "type": "python_module",
        "description": "生成最终的检测报告和防护建议",
        "module_config": {
          "function_name": "generate_security_response",
          "file_path": "modules/response_generator.py"
        },
        "position": {"x": 1300, "y": 100}
      },
      {
        "id": "safe_pass",
        "name": "安全放行",
        "type": "output_node",
        "description": "请求安全，正常放行",
        "output_config": {
          "status": "safe",
          "action": "allow",
          "message": "请求安全，正常放行"
        },
        "position": {"x": 900, "y": 400}
      },
      {
        "id": "alert_block",
        "name": "告警阻断",
        "type": "output_node", 
        "description": "生成告警并考虑阻断",
        "output_config": {
          "status": "threat_detected",
          "action": "alert_or_block"
        },
        "position": {"x": 1500, "y": 100}
      }
    ],
    "edges": [
      {
        "from": "packet_input",
        "to": "context_extraction",
        "data_mapping": {
          "input": "{{packet_input.output}}"
        }
      },
      {
        "from": "context_extraction",
        "to": "rule_engine",
        "data_mapping": {
          "packet_data": "{{packet_input.output}}",
          "context_features": "{{context_extraction.output}}"
        }
      },
      {
        "from": "rule_engine",
        "to": "risk_decision",
        "data_mapping": {
          "input": "{{rule_engine.output}}"
        }
      },
      {
        "from": "risk_decision",
        "to": "suspicious_check",
        "condition": "risk_level == '中风险'"
      },
      {
        "from": "risk_decision",
        "to": "llm_prompt_generator",
        "condition": "risk_level in ['严重', '高风险']"
      },
      {
        "from": "risk_decision",
        "to": "safe_pass",
        "condition": "risk_level == '低风险'"
      },
      {
        "from": "suspicious_check",
        "to": "llm_prompt_generator",
        "condition": "requires_llm_analysis == true"
      },
      {
        "from": "suspicious_check",
        "to": "safe_pass",
        "condition": "requires_llm_analysis == false"
      },
      {
        "from": "llm_prompt_generator",
        "to": "llm_analysis",
        "data_mapping": {
          "prompt": "{{llm_prompt_generator.output}}",
          "packet_data": "{{packet_input.output}}",
          "context_data": "{{context_extraction.output}}",
          "rule_result": "{{rule_engine.output}}"
        }
      },
      {
        "from": "llm_analysis",
        "to": "response_generator",
        "data_mapping": {
          "llm_analysis": "{{llm_analysis.output}}",
          "packet_data": "{{packet_input.output}}",
          "context_data": "{{context_extraction.output}}",
          "rule_result": "{{rule_engine.output}}"
        }
      },
      {
        "from": "response_generator",
        "to": "alert_block"
      }
    ]
  },
  "execution_settings": {
    "timeout_seconds": 30,
    "retry_count": 2,
    "parallel_execution": false,
    "error_handling": "continue_on_error",
    "logging_level": "INFO"
  },
  "monitoring": {
    "metrics": [
      "processing_time",
      "attack_detection_rate",
      "false_positive_rate",
      "throughput_requests_per_second"
    ],
    "alerts": [
      {
        "condition": "processing_time > 10s",
        "action": "send_alert"
      },
      {
        "condition": "error_rate > 5%",
        "action": "send_alert"
      }
    ]
  }
}